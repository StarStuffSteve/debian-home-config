version: '3'
services:
  # 
  # --- Backend ---
  #
  cpp-sim-battery-1:
    # Pulling from ECR rather than locally
    image: 949790903591.dkr.ecr.eu-central-1.amazonaws.com/cpp-sim-battery:latest
    # Default config of mapping stdout to Cloudwatch logs
    logging:
      driver: awslogs
      options: 
        # One must setup the demo-log-group first
        awslogs-group: demo-log-group
        awslogs-region: eu-central-1
        awslogs-stream-prefix: cpp-sim-battery-1
  cpp-sim-battery-2:
    # Pulling from ECR rather than locally
    image: 949790903591.dkr.ecr.eu-central-1.amazonaws.com/cpp-sim-battery:latest
    # Default config of mapping stdout to Cloudwatch logs
    logging:
      driver: awslogs
      options: 
        # One must setup the demo-log-group first
        awslogs-group: demo-log-group
        awslogs-region: eu-central-1
        awslogs-stream-prefix: cpp-sim-battery-2
  cpp-sim-battery-3:
    # Pulling from ECR rather than locally
    image: 949790903591.dkr.ecr.eu-central-1.amazonaws.com/cpp-sim-battery:latest
    # Default config of mapping stdout to Cloudwatch logs
    logging:
      driver: awslogs
      options: 
        # One must setup the demo-log-group first
        awslogs-group: demo-log-group
        awslogs-region: eu-central-1
        awslogs-stream-prefix: cpp-sim-battery-3
  # 
  # --- Frontend ---
  #
  flask-frontend:
    # Pulling from ECR rather than locally
    image: 949790903591.dkr.ecr.eu-central-1.amazonaws.com/flask-frontend:latest
    hostname: flask-frontend
    ports:
      - "80:80"
    # P2P links to each backend simulation containers
    links:
      - cpp-sim-battery-1
      - cpp-sim-battery-2
      - cpp-sim-battery-3
    environment:
      - SIM_BASE=cpp-sim-battery
      - SIM_HOSTS=3
    logging:
      driver: awslogs
      options:
        awslogs-group: demo-log-group
        awslogs-region: eu-central-1
        awslogs-stream-prefix: flask-frontend
